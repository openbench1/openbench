"use client";

import { useState } from "react";
import { useTranslations } from "next-intl";
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { VulnerabilityCard } from "./vulnerability-card";
import { SeverityBadge } from "./severity-badge";
import { SEVERITY_ORDER } from "@/lib/constants";
import type { Vulnerability, Severity, SeverityCounts } from "@/lib/types";

interface VulnerabilityListProps {
  vulnerabilities: Vulnerability[];
  severityCounts: SeverityCounts;
}

export function VulnerabilityList({
  vulnerabilities,
  severityCounts,
}: VulnerabilityListProps) {
  const t = useTranslations("report");
  const [filter, setFilter] = useState<Severity | "all">("all");

  const filtered =
    filter === "all"
      ? vulnerabilities
      : vulnerabilities.filter((v) => v.severity === filter);

  const activeSeverities = SEVERITY_ORDER.filter(
    (s) => s !== "gas" && severityCounts[s] > 0
  );

  return (
    <div>
      <h2 className="text-xl font-bold mb-4">{t("findings")}</h2>

      {vulnerabilities.length === 0 ? (
        <div className="text-center py-12 text-muted-foreground border border-cyber-border rounded-lg bg-cyber-card">
          <p className="text-neon-green font-medium">
            {t("noVulnerabilities")}
          </p>
        </div>
      ) : (
        <>
          <Tabs
            value={filter}
            onValueChange={(v) => setFilter(v as Severity | "all")}
          >
            <TabsList className="bg-cyber-card border border-cyber-border mb-6 flex-wrap h-auto gap-1 p-1">
              <TabsTrigger
                value="all"
                className="data-[state=active]:bg-neon-green/20 data-[state=active]:text-neon-green"
              >
                All ({vulnerabilities.length})
              </TabsTrigger>
              {activeSeverities.map((sev) => (
                <TabsTrigger
                  key={sev}
                  value={sev}
                  className="data-[state=active]:bg-neon-green/20 data-[state=active]:text-neon-green"
                >
                  <SeverityBadge
                    severity={sev}
                    label={`${t(`severity.${sev}`)} (${severityCounts[sev]})`}
                  />
                </TabsTrigger>
              ))}
            </TabsList>
          </Tabs>

          <div className="space-y-4">
            {filtered.map((vuln, index) => (
              <VulnerabilityCard
                key={vuln.id}
                vulnerability={vuln}
                index={index}
              />
            ))}
          </div>
        </>
      )}
    </div>
  );
}
